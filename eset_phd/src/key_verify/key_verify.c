#include <windows.h>

typedef int (__stdcall *verify_proc_t)(char*, int, char*, int);

/*
 */
int main(int argc, char **args)
{
    HMODULE h_mod = LoadLibrary("CrackmePHDLL.dll");
    if (h_mod)
    {
        verify_proc_t verify_proc =
            (verify_proc_t)GetProcAddress(h_mod, "?Verify@@YGHPADH0H@Z");
        if (verify_proc)
        {
            size_t i;
            char name[] = "user";
            unsigned char key[] = {
                0xba,0x4d,0x9c,0xf7,0xc7,0x2c,0xb6,0x99,0x15,0x7c,0xf1,0xf2,0x05,0x4a,0xb3,0x32,
                0xab,0xaf,0x46,0x5b,0x58,0xca,0x37,0x86,0x11,0x24,0x3d,0xd6,0xc7,0x0b,0xcd,0xea,
                0x14,0xe3,0x64,0x0c,0x91,0xc8,0x7b,0x81,0x5c,0x5b,0x29,0x5d,0x63,0x7d,0xfb,0x89,
                0x96,0x42,0x76,0x98,0x80,0xfd,0x25,0xf5,0xc9,0x13,0x8a,0x2b,0xe6,0xc0,0xb6,0xc5,

                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

            for (;;) {
                verify_proc(name, strlen(name), key, sizeof(key));
            }
        } else {
            printf("GetProcAddress() error: %d\n", GetLastError());
        }
    } else {
        printf("LoadLibrary() error: %d\n", GetLastError());
    }

    return 0;
}
